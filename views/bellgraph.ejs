<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles/Bellgraph.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <title>Bellgraph</title>
</head>
<body class="outfit">
    <%- include("header.ejs") %>
    <%- include("sidebar.ejs") %>

    <div class="bg_mainpage">
  <div class="bg_subjects">
    <% bellgraphSubjects.forEach((sub) => { %>
      <div class="subject" 
           data-course-id="<%= sub.courseId %>" 
           onclick="updateGraphForSubject('<%= sub.courseId %>', '<%= sub.name %>', this)">
        <p><%= sub.name %></p>
      </div>
    <% }) %>
  </div>

  <div class="bg_main">
    <div class="bg_graph">
      <p>Bell Graph Curve for <span id="currentSubject"><%= subject %></span></p>
      <canvas id="bellChart" width="800" height="400"></canvas>
    </div>

    <div class="bg_graphright">
      <div>
        <p>Your Grade</p>
        <p><%= userinfo %></p>
      </div>
      <div class="bg_details">
        <div>
          <p>Allotted Credits</p>
          <p><span>4</span></p>
        </div>
        <div>
          <p>Total Hours Assigned</p>
          <p><span>46</span>hrs</p>
        </div>
        <div>
          <p>Total Enrollments</p>
          <p><span>146</span></p>
        </div>
      </div>
    </div>
  </div>

  <div class="bg_ads"></div>
  <script>
    const defaultCourseId = "<%= defaultCourseId %>";
    const defaultSubject = "<%= subject %>";
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/scripts/bellgraph.js"></script>
</div>
    <script>
      async function loadGradesPartial() {
        try {
              const res = await fetch("/student/grades/partial");
              if (!res.ok) throw new Error("Failed to fetch grades partial");
              const html = await res.text();
              document.querySelector(".bg_mainpage").outerHTML = html;

              if (typeof initBellGraph === "function") initBellGraph();
            } catch (err) {
              console.error(err);
        }
      }

      loadGradesPartial()
      setInterval(loadGradesPartial, 30000);
    </script>
   
</body>
</html>